<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <title>Internet Explorer window.open() return null</title>
    <meta name="description" content="" />

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="http://www.cooljs.me/favicon.ico">

    <script type="text/javascript" src="//www.cooljs.me/themes/ichi/assets/js/vendor/fastclick.js?v=1501169677489"></script>
    <script type="text/javascript" src="//www.cooljs.me/themes/ichi/assets/js/vendor/modernizr.js?v=1501169677489"></script>


    <link rel="stylesheet" type="text/css" href="//www.cooljs.me/themes/ichi/assets/css/normalize.css?v=1501169677489" />
    <link rel="stylesheet" type="text/css" href="//www.cooljs.me/themes/ichi/assets/css/foundation.min.css?v=1501169677489" />
    <!--[if lte IE 8]>
        <link rel="stylesheet" type="text/css" href="//www.cooljs.me/themes/ichi/assets/css/outdatedBrowser.min.css?v=1501169677489">
    <![endif]-->
    <link rel="stylesheet" type="text/css" href="//www.cooljs.me/themes/ichi/assets/fonts/foundation-icons/foundation-icons.css?v=1501169677489" />
    <link rel="stylesheet" type="text/css" href="//www.cooljs.me/themes/ichi/assets/css/styles.css?v=1501169677489" />
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans:300,700,400|Source+Sans+Pro:300,400,600,700,900,300italic,400italic,600italic,700italic,900italic" />

    <link rel="canonical" href="http://www.cooljs.me/2017/07/27/Understand-IE-Protect-Mode-amp-Local-Intranet-Zone.html" />
    <meta name="referrer" content="origin" />
    
    <meta property="og:site_name" content="Elvis Zhong" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Internet Explorer window.open() return null" />
    <meta property="og:description" content="Table of Contents Troii Facebook can not connect Root Cause Analysis Debug troii Oauth2 IE Protect Mode Learned More Understand Protected Mode Understand Security Zone References Troii Facebook can not connect Our product allows customers to cnnect social media accounts for publishing messages, and use data insights to tell customers" />
    <meta property="og:url" content="http://www.cooljs.me/2017/07/27/Understand-IE-Protect-Mode-amp-Local-Intranet-Zone.html" />
    <meta property="article:published_time" content="2017-07-27T00:00:00.000Z" />
    <meta property="article:tag" content="IE Protect Mode" />
    <meta property="article:tag" content="Local Interanet Zone" />
    <meta property="article:tag" content="troii" />
    <meta property="article:tag" content="oauth2" />
    <meta property="article:tag" content="Domain" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Internet Explorer window.open() return null" />
    <meta name="twitter:description" content="Table of Contents Troii Facebook can not connect Root Cause Analysis Debug troii Oauth2 IE Protect Mode Learned More Understand Protected Mode Understand Security Zone References Troii Facebook can not connect Our product allows customers to cnnect social media accounts for publishing messages, and use data insights to tell customers" />
    <meta name="twitter:url" content="http://www.cooljs.me/2017/07/27/Understand-IE-Protect-Mode-amp-Local-Intranet-Zone.html" />
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Elvis Zhong",
    "author": {
        "@type": "Person",
        "name": "Elvis Zhong",
        "image": "https://avatars1.githubusercontent.com/u/776431?v=4",
        "url": "http://www.cooljs.me/author/Elvisz/"
    },
    "headline": "Internet Explorer window.open() return null",
    "url": "http://www.cooljs.me/2017/07/27/Understand-IE-Protect-Mode-amp-Local-Intranet-Zone.html",
    "datePublished": "2017-07-27T00:00:00.000Z",
    "keywords": "IE Protect Mode, Local Interanet Zone, troii, oauth2, Domain",
    "description": "Table of Contents Troii Facebook can not connect Root Cause Analysis Debug troii Oauth2 IE Protect Mode Learned More Understand Protected Mode Understand Security Zone References Troii Facebook can not connect Our product allows customers to cnnect social media accounts for publishing messages, and use data insights to tell customers"
}
    </script>

    <meta name="generator" content="HubPress" />
    <link rel="alternate" type="application/rss+xml" title="Elvis Zhong" href="http://www.cooljs.me/rss/" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/styles/atom-one-dark.min.css">
</head>
<body class="post-template tag-IE-Protect-Mode tag-Local-Interanet-Zone tag-troii tag-oauth2 tag-Domain">

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdate" href="http://outdatedbrowser.com/">Update my browser now</a></p>
</div>

<nav class="top-bar hide-for-large-up" data-topbar style="background: none">
  <ul class="title-area">
    <li class="name">

    </li>
    <li class="home"><a class="fi-home" href="http://www.cooljs.me"></a></li>
    <li class="toggle-topbar"><a href="#" id="trigger-overlay" class="fi-list"></a></li>
  </ul>

<div class="overlay overlay-scale">
    <button type="button" class="overlay-close">Close</button>
    <nav>
        <ul>
            <li><a href="http://www.cooljs.me">Home</a></li>
        </ul>
    </nav>
</div>

</nav>

<div class="row">

<div class="small-16 medium-16 large-4 columns right head-area bgimage" style="background-image: url(/images/idol.jpg)">

<header class="site-head">
    <div class="vertical">
        <div class="site-head-content inner">
            <ul class="side-nav blog-menu show-for-large-up">
                <li><a class="fi-home" href="http://www.cooljs.me"></a></li>
                <li><a class="fi-torso" href="http://www.cooljs.me/about"></a></li>
                <li><a class="fi-mail" href="http://www.cooljs.me/contact"></a></li>
            </ul>
            <a class="blog-logo" href="http://www.cooljs.me"><img alt="Elvis Zhong" src="/images/elvisz.jpg" alt="Blog Logo" /></a>
            <h1 class="blog-title">Elvis Zhong</h1>
            <hr>
            <p class="blog-description">Web Developer, Wower</p>
            <div class="blog-network">
              <a class="fi-rss" href="http://www.cooljs.me/rss/"></a>
<!--                 <a href="#" class="fi-social-pinterest"></a>
                <a href="#" class="fi-social-behance"></a>
                <a href="#" class="fi-social-deviant-art"></a>
                <a href="#" class="fi-social-dribbble"></a>
                <a href="#" class="fi-social-flickr"></a>
                <a href="#" class="fi-social-github"></a>
                <a href="#" class="fi-social-skype"></a>
                <a href="#" class="fi-social-snapchat"></a>
                <a href="#" class="fi-social-steam"></a>
                <a href="#" class="fi-social-xbox"></a>
                <a href="#" class="fi-social-reddit"></a> -->
                  <a href="https://www.linkedin.com/in/elviszhong/" class="fi-social-linkedin"></a>
                  <a href="https://github.com/Elvisz" class="fi-social-github"></a>
                  <a href="https://twitter.com/elvis_zhong" class="fi-social-twitter"></a>
                  <a href="https://www.facebook.com/elvis.m.zhong" class="fi-social-facebook"></a>
            </div>
        </div>
    </div>
</header>

</div>


<div class="small-16 medium-16 large-12 columns main-column left">
    

<main class="content" role="main">

    <article class="post tag-IE-Protect-Mode tag-Local-Interanet-Zone tag-troii tag-oauth2 tag-Domain">


            <h1 class="post-title">Internet Explorer window.open() return null</h1>

            <span class="post-meta label"><time datetime="2017-07-27">27 Jul 2017</time></span>

            <section class="post-content">
                <div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_troii_facebook_can_not_connect">Troii Facebook can not connect</a></li>
<li><a href="#_root_cause_analysis">Root Cause Analysis</a>
<ul class="sectlevel2">
<li><a href="#_debug_troii_oauth2">Debug troii Oauth2</a></li>
<li><a href="#_ie_protect_mode">IE Protect Mode</a></li>
</ul>
</li>
<li><a href="#_learned_more">Learned More</a>
<ul class="sectlevel2">
<li><a href="#_understand_protected_mode">Understand Protected Mode</a></li>
<li><a href="#_understand_security_zone">Understand Security Zone</a></li>
</ul>
</li>
<li><a href="#_references">References</a></li>
</ul>
</div>
<div class="sect1">
<h2 id="_troii_facebook_can_not_connect">Troii Facebook can not connect</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://www.activitycloud.com/target-marketer">Our product</a> allows customers to cnnect social media accounts for publishing messages, and use data insights to tell customers when people are most likely to interact with their messaging.</p>
</div>
<div class="paragraph">
<p>Recently regression test, QA team report an issue that can not connect Facebook on IE, but it works fine on Chrome and Firefox.</p>
</div>
<div class="paragraph">
<p>We have tested the social media connect process on vitual machine with Window 10 + IE11, it can connect, but it failed on QA&#8217;PC with Windows 10 + IE11.</p>
</div>
<div class="paragraph">
<p>After reviewing recent commits on our repo, there is no changes related to the connect social media process.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_root_cause_analysis">Root Cause Analysis</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We do not have a clue about the issue, and we try to debug the connect process on QA&#8217;PC.</p>
</div>
<div class="sect2">
<h3 id="_debug_troii_oauth2">Debug troii Oauth2</h3>
<div class="paragraph">
<p>Base on the error message, after search the <em>troii</em> source code with "Popup could not open or was closed", finnally step in to  <a href="https://github.com/Vestorly/torii/blob/0.6.1/lib/torii/services/popup.js#L79">torii/services/popup.js#L79</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">service.popup = window.open(url, pendingRequestKey, optionsString); //<i class="conum" data-value="1"></i><b>(1)</b>

if (service.popup &amp;&amp; !service.popup.closed) {
  service.popup.focus();
} else {
  reject(new Error(
    'Popup could not open or was closed'));
  return;
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>service.popup here is <code>null</code></td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We test <code>window.open('http://www.google.com')</code> on console and it returns <code>null</code> value, so the program will goto the <code>else</code> branch and cause this issue happen.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ie_protect_mode">IE Protect Mode</h3>
<div class="paragraph">
<p>After google "window.open() return null in IE" and there are many answers on stackoverflow mentions the <em>IE Protect Mode</em>.</p>
</div>
<div class="paragraph">
<p>We just enable the <em>IE Protect Mode</em> on virtual machine, it can not connect Facebook account and throw error "Popup could not open or was closed" like the QA&#8217;PC.</p>
</div>
<div class="paragraph">
<p><em>IE Protect Mode</em> will cause <code>window.open()</code> return <code>null</code> as:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Internet Explorer 7 on Windows Vista: Opening a new window from an application (other than the Internet Explorer process) may result in a null return value. This restriction occurs because Internet Explorer runs in protected mode, by default. One facet of protected mode prevents applications from having privileged access to Internet Explorer when that access spans process boundaries. Opening a new window by using this method generates a new process. For more information about protected mode, see <a href="https://msdn.microsoft.com/zh-cn/library/bb250462(v=vs.85).aspx">Understanding and Working in Protected Mode Internet Explorer</a>. This commonly occurs for applications that host the WebBrowser control.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>And now, this issue can be resolved as the evironment issue.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_learned_more">Learned More</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_understand_protected_mode">Understand Protected Mode</h3>
<div class="qlist qanda">
<ol>
<li>
<p><em>What&#8217;s the defaul <em>Protect Mode</em> setting</em></p>
<p>IE will enable <em>Protect Mode</em> for <em>Internet Zone</em> and <em>Restricted sites Zone</em> by default</p>
</li>
<li>
<p><em>When <code>window.open()</code> will return <code>null</code></em></p>
<p>There are 2 conditions:</p>
<div class="ulist">
<ul>
<li>
<p>Access from one security zone to another security zone, such as: <em>Local Intranet Zone</em> &#8658; <em>Internet Zone</em></p>
</li>
<li>
<p>At least one of the security zones has enabled <em>Protect Zone</em></p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_understand_security_zone">Understand Security Zone</h3>
<div class="qlist qanda">
<ol>
<li>
<p><em>How to know current site working in which security zone?</em></p>
<p>Right click page and choose <em>properties</em>, on the <em>properties</em> tab, check field like: "Zone: Internet | Protected Mode: on".</p>
</li>
<li>
<p><em>How does IE determine a site belongs Local Intranet Zone?</em></p>
<p>Instead, determination that a site belongs to the <em>Local Intranet Zone</em> is based on a number of rules:</p>
</li>
</ol>
</div>
<div class="quoteblock">
<blockquote>
<div class="ulist">
<ul>
<li>
<p>Direct Mapping. As with other Zones, users or network admins may map a list of URL patterns into the Local Intranet Zone. This list is viewable by clicking Tools &gt; Internet Options &gt; Security &gt;  Local Intranet &gt; Sites &gt; Advanced.</p>
</li>
<li>
<p>The PlainHostName rule (aka "The Dot rule"). If the URI’s hostname doesn’t contain any periods (e.g. <a href="http://team/" class="bare">http://team/</a>) then it is mapped to the Local Intranet Zone.</p>
</li>
<li>
<p>The fixed Proxy Bypass list. If the user has a fixed proxy specified inside Tools &gt; Internet Options &gt; Connections &gt; LAN Settings, then sites listed to bypass that proxy will be mapped to the Local Intranet zone. The fixed proxy bypass list can be found by clicking the Advanced button; it’s at the bottom of the screen in the box labeled Exceptions.</p>
</li>
<li>
<p>(WPAD) Proxy Script. If the user’s proxy configuration is “Automatically detect settings” or “Use automatic configuration script” inside Tools &gt; Internet Options &gt; Connections &gt; LAN Settings, the browser will run the FindProxyForUrl function in the specified WPAD proxy configuration script to determine which proxy should be used for each request. If the script returns "DIRECT", the browser will bypass the proxy and the site will be mapped into the Local Intranet Zone. When mapping a URL to a Zone, URLMon will call the FindProxyForUrl function to determine if the bypass rule applies. One interesting twist is that the proxy script may itself call dnsResolve to get a site’s IP address and use that information as a part of its determination.</p>
</li>
</ul>
</div>
</blockquote>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_references">References</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="https://msdn.microsoft.com/library/ms536651(v=vs.85).aspx" class="bare">https://msdn.microsoft.com/library/ms536651(v=vs.85).aspx</a>.</p>
</li>
<li>
<p><a href="https://blogs.msdn.microsoft.com/ieinternals/2012/06/05/the-intranet-zone/" class="bare">https://blogs.msdn.microsoft.com/ieinternals/2012/06/05/the-intranet-zone/</a></p>
</li>
</ol>
</div>
</div>
</div>
                        <aside class="tags fi-pricetag-multiple">Posted on <a href="http://www.cooljs.me/tag/IE-Protect-Mode/">IE Protect Mode</a>, <a href="http://www.cooljs.me/tag/Local-Interanet-Zone/">Local Interanet Zone</a>, <a href="http://www.cooljs.me/tag/troii/">troii</a>, <a href="http://www.cooljs.me/tag/oauth2/">oauth2</a>, <a href="http://www.cooljs.me/tag/Domain/">Domain</a></aside>
            </section>
            <hr>
            <footer class="post-footer">

                <section class="share">
                    <h4>Liked this post ? Share it.</h4>
                    <a class="fi-social-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.cooljs.me/2017/07/27/Understand-IE-Protect-Mode-amp-Local-Intranet-Zone.html"
                        onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    </a>
                    <a class="fi-social-twitter" href="https://twitter.com/share?text=Internet%20Explorer%20window.open()%20return%20null&amp;url=http://www.cooljs.me/2017/07/27/Understand-IE-Protect-Mode-amp-Local-Intranet-Zone.html"
                        onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    </a>
                    <a class="fi-social-google-plus" href="https://plus.google.com/share?url=http://www.cooljs.me/2017/07/27/Understand-IE-Protect-Mode-amp-Local-Intranet-Zone.html"
                       onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    </a>
                </section>

                <section class="author">
                    <header>
                        <span>About the author</span>
                    </header>
                    <section>
                        <h4>Elvis Zhong</h4>
                        <img src="https://avatars1.githubusercontent.com/u/776431?v&#x3D;4">
                        <span>SiChuan ChengDu, China</span>
                        
                    </section>
                    <footer>
                         <p></p>
                    </footer>
                </section>

        <div class="clearfix"></div>
                    <hr>

            </footer>

        <h3 class="title-disqus"><span class="fi-comments"></span>Discussions</h3>




        <section class="post-comments">
          <div id="disqus_thread"></div>
          <script type="text/javascript">
          var disqus_shortname = 'elvisz'; // required: replace example with your forum shortname
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        </section>


    </article>

</main>

</div>

</div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment-with-locales.min.js?v="></script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js?v="></script> 
      <script type="text/javascript">
        jQuery( document ).ready(function() {
          // change date with ago
          jQuery('ago.ago').each(function(){
            var element = jQuery(this).parent();
            element.html( moment(element.text()).fromNow());
          });
        });

        hljs.initHighlightingOnLoad();
      </script>
       
    <script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

    <!--[if lte IE 8]>
        <script type="text/javascript" src="//www.cooljs.me/themes/ichi/assets/js/outdatedBrowser.min.js?v=1501169677489"></script>
    <![endif]-->
    <script type="text/javascript" src="//www.cooljs.me/themes/ichi/assets/js/min/built.js?v=1501169677489"></script>

    <script>
      $(document).foundation();
    </script>

    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-72031894-1', 'auto');
    ga('send', 'pageview');

    </script>
</body>
</html>
